apiVersion: reviewpad.com/v1alpha

groups:
  - name: juniors
    description: Group of junior devs
    kind: developers
    spec: '["shay2025"]'

  - name: seniors
    description: Group of devs that have created more than 2 PRs
    kind: developers
    type: filter
    param: dev
    where: $totalCreatedPRs($dev) > 2

rules:
  - name: changesToMDFiles
    kind: patch
    description: Files with extension .md
    spec: $filesExtensions([".md"])

  - name: changesMainFile
    kind: patch
    description: Main file
    spec: $hasFileName("go/main.go")

  - name: authoredByJunior
    kind: author
    description: Authored by junior dev
    spec: $isMemberOf($name(), $group("juniors"))

  - name: isSmallPatch
    kind: patch
    description: Patch has less than 90 changes and 6 files
    spec: $size() < 90 && $fileCount() <= 5

  - name: changesCriticalCode
    description: The diffs involves a critical method or function
    kind: patch
    spec: $hasAnnotation("critical")

  - name: callsQuicksort
    kind: patch
    description: The diff contains the keyword quicksort
    spec: $codeQuery("quicksort")

protectionGates:
  - name: critical
    description: Modification of critical code require careful review
    patchRules:
      - rule: changesCriticalCode
      - rule: callsQuicksort
    actions:
      - $addLabel("priority")
      - $assignReviewer($group("seniors"))

  - name: standard
    description: Standard review process
    patchRules:
      - rule: changesMainFile
        extraActions:
          - $assignReviewer(["ferreiratiago"])
      - rule: authoredByJunior
    actions:
      - $addLabel("ask")
      - $assignRandomReviewer()

  - name: ship
    description: Ship process
    patchRules:
      - rule: changesToMDFiles
      - rule: isSmallPatch
    actions:
      - $addLabel("ship")
      - $merge("rebase")